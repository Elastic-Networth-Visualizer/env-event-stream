<svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="900" height="700" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="450" y="40" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    ENV Event Stream Architecture
  </text>
  <text x="450" y="70" font-family="Arial" font-size="16" text-anchor="middle" fill="#666">
    High-Performance Event-Driven Architecture Library for Deno
  </text>

  <!-- Core Components Section -->
  <rect x="50" y="100" width="800" height="180" rx="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1" />
  <text x="450" y="120" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="#0d47a1">Core Components</text>
  
  <!-- EventBroker -->
  <rect x="80" y="140" width="160" height="110" rx="5" fill="#bbdefb" stroke="#2196f3" stroke-width="1" />
  <text x="160" y="162" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">EventBroker</text>
  <text x="160" y="185" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Central coordinator</text>
  <text x="160" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Manages topics</text>
  <text x="160" y="220" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Routes events</text>
  <text x="160" y="235" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Coordinates pub/sub</text>

  <!-- Topic -->
  <rect x="280" y="140" width="160" height="110" rx="5" fill="#bbdefb" stroke="#2196f3" stroke-width="1" />
  <text x="360" y="162" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">Topic</text>
  <text x="360" y="185" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Categorizes events</text>
  <text x="360" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Distributes events</text>
  <text x="360" y="220" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Manages subscriptions</text>
  <text x="360" y="235" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Applies retention policies</text>

  <!-- Subscription -->
  <rect x="480" y="140" width="160" height="110" rx="5" fill="#bbdefb" stroke="#2196f3" stroke-width="1" />
  <text x="560" y="162" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">Subscription</text>
  <text x="560" y="185" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Event handler bindings</text>
  <text x="560" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Delivers events</text>
  <text x="560" y="220" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Manages retry logic</text>
  <text x="560" y="235" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Filters by event type</text>

  <!-- Events -->
  <rect x="680" y="140" width="160" height="110" rx="5" fill="#bbdefb" stroke="#2196f3" stroke-width="1" />
  <text x="760" y="162" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">Event</text>
  <text x="760" y="185" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Data structure</text>
  <text x="760" y="205" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Unique ID</text>
  <text x="760" y="220" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Payload + Metadata</text>
  <text x="760" y="235" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Type + Schema version</text>

  <!-- Storage Section -->
  <rect x="50" y="300" width="800" height="140" rx="10" fill="#e8f5e9" stroke="#4caf50" stroke-width="1" />
  <text x="450" y="320" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="#1b5e20">Storage &amp; Persistence</text>
  
  <!-- EventStore -->
  <rect x="80" y="340" width="220" height="80" rx="5" fill="#c8e6c9" stroke="#4caf50" stroke-width="1" />
  <text x="190" y="362" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#1b5e20">EventStore</text>
  <text x="190" y="380" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- InMemoryEventStore</text>
  <text x="190" y="400" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- FileEventStore</text>

  <!-- Dead Letter Queue -->
  <rect x="340" y="340" width="220" height="80" rx="5" fill="#c8e6c9" stroke="#4caf50" stroke-width="1" />
  <text x="450" y="362" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#1b5e20">DeadLetterQueue</text>
  <text x="450" y="380" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- SimpleDeadLetterQueue</text>
  <text x="450" y="400" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- FileDeadLetterQueue</text>

  <!-- Schema Registry -->
  <rect x="600" y="340" width="220" height="80" rx="5" fill="#c8e6c9" stroke="#4caf50" stroke-width="1" />
  <text x="710" y="362" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#1b5e20">SchemaRegistry</text>
  <text x="710" y="380" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- JsonSchemaRegistry</text>
  <text x="710" y="400" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">- Validates event payloads</text>

  <!-- Event Sourcing Section -->
  <rect x="50" y="460" width="800" height="210" rx="10" fill="#fff3e0" stroke="#ff9800" stroke-width="1" />
  <text x="450" y="480" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="#e65100">Event Sourcing</text>
  
  <!-- Event Sourced Entity -->
  <rect x="80" y="500" width="220" height="150" rx="5" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" />
  <text x="190" y="522" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#e65100">EventSourcedEntity</text>
  <text x="190" y="540" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Base class</text>
  <text x="190" y="560" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Manages state via events</text>
  <text x="190" y="575" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Applies events to update state</text>
  <text x="190" y="590" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Tracks entity version</text>

  <!-- Aggregate Root -->
  <rect x="340" y="500" width="220" height="150" rx="5" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" />
  <text x="450" y="522" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#e65100">AggregateRoot</text>
  <text x="450" y="540" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Domain entity representation</text>
  <text x="450" y="560" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Extends EventSourcedEntity</text>
  <text x="450" y="575" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Records domain events</text>
  <text x="450" y="590" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Tracks uncommitted events</text>
  <text x="450" y="605" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Domain-specific logic</text>
  <text x="450" y="620" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Enforces business rules</text>

  <!-- Repository -->
  <rect x="600" y="500" width="220" height="150" rx="5" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" />
  <text x="710" y="522" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#e65100">EventSourcedRepository</text>
  <text x="710" y="540" font-family="Arial" font-size="12" text-anchor="middle" fill="#333" font-style="italic">Aggregate persistence</text>
  <text x="710" y="560" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Saves and loads aggregates</text>
  <text x="710" y="575" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Persists events to EventStore</text>
  <text x="710" y="590" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Rehydrates from events</text>
  <text x="710" y="605" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">- Factory support via</text>
  <text x="710" y="620" font-family="Arial" font-size="11" text-anchor="middle" fill="#555">  RepositoryFactory</text>

  <!-- Connections -->
  <!-- Core Components Connections -->
  <line x1="240" y1="195" x2="280" y2="195" stroke="#2196f3" stroke-width="2" />
  <polygon points="275,190 285,195 275,200" fill="#2196f3" />
  
  <line x1="440" y1="195" x2="480" y2="195" stroke="#2196f3" stroke-width="2" />
  <polygon points="475,190 485,195 475,200" fill="#2196f3" />
  
  <line x1="640" y1="195" x2="680" y2="195" stroke="#2196f3" stroke-width="2" />
  <polygon points="675,190 685,195 675,200" fill="#2196f3" />

  <!-- EventBroker to Storage -->
  <line x1="160" y1="250" x2="160" y2="340" stroke="#1b5e20" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="155,335 160,345 165,335" fill="#1b5e20" />
  
  <line x1="190" y1="250" x2="450" y2="340" stroke="#1b5e20" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="445,335 455,340 445,345" fill="#1b5e20" />

  <!-- Topic to Schema Registry -->
  <line x1="360" y1="250" x2="710" y2="340" stroke="#1b5e20" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="705,335 715,340 705,345" fill="#1b5e20" />

  <!-- Event Store to EventSourcedRepository -->
  <line x1="190" y1="420" x2="710" y2="500" stroke="#e65100" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="705,495 715,500 705,505" fill="#e65100" />

  <!-- AggregateRoot to EventSourcedEntity -->
  <line x1="450" y1="575" x2="300" y2="575" stroke="#e65100" stroke-width="2" />
  <polygon points="305,570 295,575 305,580" fill="#e65100" />

  <!-- Repository to AggregateRoot -->
  <line x1="600" y1="575" x2="560" y2="575" stroke="#e65100" stroke-width="2" />
  <polygon points="565,570 555,575 565,580" fill="#e65100" />

  <!-- Legend -->
  <rect x="50" y="680" width="15" height="10" fill="#bbdefb" stroke="#2196f3" stroke-width="1" />
  <text x="75" y="690" font-family="Arial" font-size="12" fill="#333">Core Components</text>
  
  <rect x="200" y="680" width="15" height="10" fill="#c8e6c9" stroke="#4caf50" stroke-width="1" />
  <text x="225" y="690" font-family="Arial" font-size="12" fill="#333">Storage &amp; Persistence</text>
  
  <rect x="390" y="680" width="15" height="10" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" />
  <text x="415" y="690" font-family="Arial" font-size="12" fill="#333">Event Sourcing</text>
  
  <line x1="550" y1="685" x2="580" y2="685" stroke="#000" stroke-width="2" />
  <text x="590" y="690" font-family="Arial" font-size="12" fill="#333">Direct Dependency</text>
  
  <line x1="700" y1="685" x2="730" y2="685" stroke="#000" stroke-width="2" stroke-dasharray="5,3" />
  <text x="740" y="690" font-family="Arial" font-size="12" fill="#333">Indirect Dependency</text>
</svg>